<html>
<head>
    <title>GeoChat</title>
    <link rel='stylesheet' href='/stylesheets/chat.css'/>
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script>
        $(function(){
            $("#tabs").tabs();
            
            $("#tabs").find(".ui-tabs-nav").sortable({
                axis: "x",
                stop: function() {
                    tabs.tabs( "refresh" );
                }
            });
        });
    </script>
    <script src="/socket.io/socket.io.js"></script>
	
	<script src="/js/PresenceClient.js"></script>
    <script src="/js/ChatClient.js"></script>
    <script src="/js/NotificationClient.js"></script>
    <script src="/js/NicknameClient.js"></script>
    <script src="/js/BuildingClient.js"></script>
    <script src="/js/TabClient.js"></script>

    <!--Google Maps API key  AIzaSyB7Rh3B0j0VsvVZ9a50ttAWmM28LAUc838-->
    <script type="text/javascript"
            src="//maps.googleapis.com/maps/api/js?sensor=false"></script>


</head>
<body onLoad = "onLoad()">
<script>
    function onLoad(){
        getUserLocation();
        initialize();
    }
</script>
<script>
    var LAT = 0;
    var LONG = 0;

    function getUserLocation()
    {
        if (navigator.geolocation)
        {
            navigator.geolocation.watchPosition(getCoordinates, handleError, {frequency: 300000});  //updates user location every 5 minutes
        }
        else{console.log("Geolocation is not supported by this browser.");}
    }
    function getCoordinates(position)
    {
        LAT = position.coords.latitude;
        LONG = position.coords.longitude;

        var latlon=LAT+","+LONG;
        socket.emit('location_update', {latitude: LAT, longitude: LONG});

        initialize();

        google.maps.event.addDomListener(window, 'load', initialize);
    }
    function initialize()
    {
        var mapOptions = {
            center: new google.maps.LatLng(LAT, LONG),
            zoom: 15
        };
        var map = new google.maps.Map(document.getElementById("mapholder"), mapOptions);
        var marker = new google.maps.Marker({
            map: map,
            position: new google.maps.LatLng(LAT, LONG)
        });
        marker.setMap(map);
    }
    function handleError(error)
    {
        switch(error.code)
        {
            case error.PERMISSION_DENIED:
                console.log("User denied the request for Geolocation.");
                break;
            case error.POSITION_UNAVAILABLE:
                console.log("Location information is unavailable.");
                break;
            case error.TIMEOUT:
                console.log("The request to get user location timed out.");
                break;
            case error.UNKNOWN_ERROR:
                console.log("An unknown error occurred.");
                break;
        }
    }
</script>
<div id="menus">
    <ul>
        <li><p>Account</p>
            <ul>
                <li><a href="logOut">Log out</a></li>
            </ul>
        </li>
        <li><a href="updateLocation">Update Location</a></li>
        <form id="nicknameBox">Chatting As: <span id="current_nickname"></span></form>
    </ul>
</div>
<div id="tabs" class="inline">
    <ul id="tab_list">
        <li><a id="noPad" href="#tabs-nearby">Nearby</a></li>
    </ul>
    <div id="tabs-nearby">
        <div class="chat"></div>
        <form class="textEntry" data-id="nearby">
            <input class="message" type="text" autocomplete="off">
            <button type="submit">Send</button>
        </form>
        <div class="userList" class="inline"></div>
    </div>
</div>

<div class="inline" id="roomList">
    <ul>
        <% buildings.forEach(function(building){ %>
        <li data-id="<%= building.id %>" data-name="<%= building.name %>"><%= building.name %></li>
        <% }); %>
    </ul>
</div>
<div id="mapholder"></div>
</body>
</html>
